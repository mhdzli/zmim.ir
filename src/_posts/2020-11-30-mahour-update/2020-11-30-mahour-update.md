---
title: Ø¨Ù‡ Ø±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡ Ù…Ø§Ù‡ÙˆØ±.
date: 2020-11-03 08:10:47 +03:30
modified:
tags: [unix/linux, foss, Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù† ]
description: Ù…Ø§Ù‡ÙˆØ± ÛŒÚ© Ø§ÙØ²ÙˆÙ†Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ø³ØªÙˆÙ† ØªØ§Ø±ÛŒØ® Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ Ø¨Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ø§ÛŒÙ…ÛŒÙ„ Ù…Ø­Ø¨ÙˆØ¨ Thunderbird Ø§Ø³Øª.
mastodon:
  host: mas.to
  username: mz
  id: 105148912382290635
---


Ø¯Ø± Ø§ÛŒÙ† Ù¾Ø³Øª ØªÙ„Ø§Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ù… Ø¨Ù‡ Ø¨Ù‡Ø§Ù†Ù‡ Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡ [Ù…Ø§Ù‡ÙˆØ±](https://addons.thunderbird.net/en-us/thunderbird/addon/mahour-iranian-date/){:target="_blank"}{:rel="noopener noreferrer"} Ú©Ù…ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ§ÛŒØ±ÙØ§Ú©Ø³ Ùˆ Ú†Ú¯ÙˆÙ†Ú¯ÛŒ Ø³Ø§Ø®Øª ÛŒÚ© Ø§ÙØ²ÙˆÙ†Ù‡ Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒØ±ÙØ§Ú©Ø³ Ø¨Ù†ÙˆÛŒØ³Ù….

# Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ§ÛŒØ±ÙØ§Ú©Ø³

ØªØ§ Ù¾ÛŒØ´ Ø§Ø² Ù†ÙˆØ§Ù…Ø¨Ø± Û²Û°Û±Û· Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª ÛŒÚ© Ø§ÙØ²ÙˆÙ†Ù‡ ÙØ§ÛŒØ±ÙØ§Ú©Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´Øª Ø§Ù…Ø§ Ø¯Ø± Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡ Ø±ÙˆØ²ØªØ± Ø¨Ø±Ø®ÛŒ Ø§Ø² Ø¢Ù†Ù‡Ø§ Ù…Ø§Ù†Ù†Ø¯ â€«`overlay add-ons`â€¬ØŒ â€«`bootstrapped add-ons`â€¬ØŒ â€«`Add-on SDK`â€¬ Ùˆ ... Ø¯ÛŒÚ¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² [WebExtensions API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions){:target="_blank"}{:rel="noopener noreferrer"}Ù‡Ø§ Ø³Ø§Ø®ØªÙ‡ Ø´ÙˆÙ†Ø¯. Ø§Ú¯Ø± ÛŒÚ© Ø§ÙØ²ÙˆÙ†Ù‡ `Legacy` Ø¯Ø§Ø±ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¢Ù† Ø¨Ø§ Ù†Ø³Ø®Ù‡ Ù‡Ø§ÛŒ Ø¨Ù‡ Ø±ÙˆØ² ÙØ§ÛŒØ±ÙØ§Ú©Ø³ Ùˆ Ø³Ø§Ø®Øª `WebExtension` Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² [Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù…ÙˆØ²ÛŒÙ„Ø§](https://extensionworkshop.com/documentation/develop/porting-a-legacy-firefox-extension/){:target="_blank"}{:rel="noopener noreferrer"} Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.

## Ø³Ø§Ø®ØªØ§Ø± `WebExtension`Ù‡Ø§

Ù‡Ø± `WebExtension` ÛŒÚ© ÙØ§ÛŒÙ„ [`manifest.json`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json){:target="_blank"}{:rel="noopener noreferrer"} Ø¯Ø§Ø±Ø¯ Ú©Ù‡ Ø³Ø§Ø®ØªØ§Ø±ØŒ Ù…Ù†Ø§Ø¨Ø¹ Ùˆ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¢Ù† Ø±Ø§ Ù…Ø´Ø®Øµ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø¹Ú©Ø³ Ø²ÛŒØ± Ø³Ø§Ø®ØªØ§Ø± Ú©Ù„ÛŒ ÙØ§ÛŒÙ„ `manifest.jason` Ø±Ø§ Ø¯Ø± ÛŒÚ© `WebExtension` Ù†Ø´Ø§Ù† Ù…ÛŒ Ø¯Ù‡Ø¯.

<div style="text-align: center;">
    <img src="webextension-anatomy.png" style="max-width: 80%; margin: 10px;" alt="Ø³Ø§Ø®ØªØ§Ø± webextensionÙ‡Ø§">
</div>

Ù†Ù…ÙˆÙ†Ù‡ ÙØ§ÛŒÙ„ `manifest.json` Ø§ÙØ²ÙˆÙ†Ù‡ Ù…Ø§Ù‡ÙˆØ±: 

<div class="code-block">
{% highlight json %}
{
  "manifest_version": 2,
  "name": "Mahour",
  "description": "Adds a new Iranian(Persian/Jalali/Khorshidi) date column to ThunderBird.",
  "version": "1.1.2",
  "homepage_url": "https://github.com/mhdzli/mahour",
  "author": "M.Zeinali",
  "applications": {
    "gecko": {
      "id": "mahour@zmim.ir",
      "strict_min_version": "68.0a1"
    }
  },
  "[experiment_apis](experiment_apis)": {
    "MahourDate": {
      "schema": "api/schema.json",
      "parent": {
        "scopes": ["addon_parent"],
        "paths": [["MahourDate"]],
        "script": "api/experiments.js"
      }
    }
  },
  "background": {
    "scripts": ["background/background.js"]
  },
  "browser_action": {
    "default_title": "Ù…Ø§Ù‡ÙˆØ±",
    "default_popup": "popup/popup.html",
    "default_icon": {
      "48": "assets/icons/icon48.png"
    }
  },
  "options_ui": {
    "page": "options/options.html",
    "open_in_tab": false
  },
  "icons": {
    "32": "assets/icons/icon32.png",
    "48": "assets/icons/icon48.png",
    "64": "assets/icons/icon64.png",
    "128": "assets/icons/icon128.png"
  },
  "permissions": ["storage"]
}
{% endhighlight %}
</div>

Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¯Ø±Ø¨Ø±Ø¯Ø§Ø±Ù†Ø¯Ù‡ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ø³Øª:
* Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø§Ø³Ø§Ø³ÛŒ Ú©Ù‡ Ø¨Ø§ÛŒØ³Øª Ø­ØªÙ…Ø§ ØªØ¹Ø±ÛŒÙ Ø´ÙˆÙ†Ø¯:
	- ÙˆØ±Ú˜Ù† Ù…Ø§Ù†ÛŒÙØ³Øª ([`manifest_version`](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/manifest_version){:target="_blank"}{:rel="noopener noreferrer"})
	- Ù†Ø§Ù… Ø§ÙØ²ÙˆÙ†Ù‡ ([`name`](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/name){:target="_blank"}{:rel="noopener noreferrer"})
	- ÙˆØ±Ú˜Ù† Ø§ÙØ²ÙˆÙ†Ù‡ ([`version`](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/version){:target="_blank"}{:rel="noopener noreferrer"})
* Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ:
	- ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ ([`description`](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/description){:target="_blank"}{:rel="noopener noreferrer"})
	- Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ ([`icons`](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/icons){:target="_blank"}{:rel="noopener noreferrer"})
	- ÙˆØ¨Ú¯Ø§Ù‡ ÛŒØ§ Ù…Ø®Ø²Ù† Ø§ÙØ²ÙˆÙ†Ù‡ ([`homepage_url`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url){:target="_blank"}{:rel="noopener noreferrer"})
	- Ø³Ø§Ø²Ù†Ø¯Ù‡ ([`author`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author){:target="_blank"}{:rel="noopener noreferrer"})
* ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆÛŒÚ˜Ù‡ Ù…Ø±ÙˆØ±Ú¯Ø± ([`browser_specific_settings`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings){:target="_blank"}{:rel="noopener noreferrer"} ÛŒØ§ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ `applications`). ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡ [Ú†Ù†Ø§Ù†Ú†Ù‡ Ù†ÛŒØ§Ø² Ø¨Ø§Ø´Ø¯](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/WebExtensions_and_the_Add-on_ID#When_do_you_need_an_add-on_ID){:target="_blank"}{:rel="noopener noreferrer"} Ø¯Ø± Ø§ÛŒÙ† Ú©Ù„ÛŒØ¯ Ù…Ø´Ø®Øµ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯:
	- Ø­Ø¯Ø§Ù‚Ù„ ÙˆØ±Ú˜Ù† Ù…ÙˆØªÙˆØ± Ø³Ø§Ø®Øª Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø± (`gecko`: content rendering engine)
	- Ø´Ù†Ø§Ø³Ù‡ Ø§ÙØ²ÙˆÙ†Ù‡ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØªÙˆØ± ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§ (`gecko.id`)
* Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡ ([`Background scripts`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension#Background_scripts){:target="_blank"}{:rel="noopener noreferrer"}): Ø§ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¯Ø± Ù‚Ø§Ù„Ø¨ ÛŒÚ© ØµÙØ­Ù‡ ÙˆÛŒÚ˜Ù‡ Ø¨Ù‡ Ù†Ø§Ù… `background page` Ø¯Ø± Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
* Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®Øª Ù…Ø­ØªÙˆØ§ ([`Content scripts`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts){:target="_blank"}{:rel="noopener noreferrer"}) Ú©Ù‡ Ú©Ø§Ø± Ø§ØµÙ„ÛŒ Ø±Ø§ Ø¨Ø± Ø¹Ù‡Ø¯Ù‡ Ø¯Ø§Ø±Ù†Ø¯ Ùˆ Ø®ÙˆØ±Ø§Ú© Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ú¯ÙˆÙ†Ø§Ú¯ÙˆÙ† Ø§ÙØ²ÙˆÙ†Ù‡ Ø±Ø§ ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯. Ø§ÙØ²ÙˆÙ†Ù‡ Ù…Ø§Ù‡ÙˆØ± Ø¨Ù‡ Ø¬Ø§ÛŒ Ø§ÛŒÙ† Ú©Ù„ÛŒØ¯ Ø§Ø² [`experiment_apis`](https://firefox-source-docs.mozilla.org/toolkit/components/extensions/webextensions/basics.html#webextensions-experiments){:target="_blank"}{:rel="noopener noreferrer"} Ø¨Ù‡Ø±Ù‡ Ø¨Ø±Ø¯Ù‡ Ø§Ø³Øª. Ø§Ø³Ú©Ø±ÛŒÙ¾Øª ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§ Ø¯Ø±ÙˆÙ† `API` Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
* Ø±Ø§Ø¨Ø· Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± ([`experiment_apis`](https://firefox-source-docs.mozilla.org/toolkit/components/extensions/webextensions/basics.html?highlight=experiment_apis#webextensions-experiments){:target="_blank"}{:rel="noopener noreferrer"}): Ø¨Ø§ Ø§ÛŒÙ† Ú©Ù„ÛŒØ¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù† ÛŒÚ© Ø±Ø§Ø¨Ø· Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ÛŒ ØªØ§Ø²Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ø§ÙØ²ÙˆÙ†Ù‡ Ø³Ø§Ø®Øª.
* ØµÙØ­Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´ ÙØ±Ø¶ Ú©Ù‡ Ù…Ø§Ù†Ù†Ø¯ ÛŒÚ© ØµÙØ­Ù‡ ÙˆØ¨ Ù…Ø¹Ù…ÙˆÙ„ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø§Ø² ÙØ§ÛŒÙ„Ù‡Ø§ÛŒ `css` Ùˆ `js` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ù†Ø¯:
	- Ù†ÙˆØ§Ø± Ú©Ù†Ø§Ø±ÛŒ ([`Sidebars`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/sidebar_action){:target="_blank"}{:rel="noopener noreferrer"})
	- Ù¾Ù†Ø¬Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²Ø´Ùˆ (`popups`) ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¢Ù† Ø¯Ø± Ú©Ù„ÛŒØ¯ [`browser_action || page_action`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/page_action){:target="_blank"}{:rel="noopener noreferrer"} ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
	- Ø³Ø§Ù…Ø§Ù†â€ŒØ¯Ù‡ÛŒ (`options`): ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¢Ù† Ø¯Ø± Ú©Ù„ÛŒØ¯ [`options_ui`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_ui){:target="_blank"}{:rel="noopener noreferrer"}  ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø§ÛŒÙ† Ú©Ù„ÛŒØ¯ Ø¯Ø± ØµÙØ­Ù‡ `Add-ons Manager` Ú¯Ø²ÛŒÙ†Ù‡ `Preferences` Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡ Ù†Ù…Ø§ÛŒØ§Ù† Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø¨Ø§ Ú©Ù„ÛŒÚ© Ú©Ø±Ø¯Ù† Ø±ÙˆÛŒ Ø¢Ù†ØŒ ØµÙØ­Ù‡ Ø³Ø§Ù…Ø§Ù†Ø¯Ù‡ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ùˆ Ø§Ù…Ú©Ø§Ù† ØªØºÛŒÛŒØ± ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡ Ø±Ø§ ÙØ±Ø§Ù‡Ù… Ù…ÛŒâ€ŒÚ©Ù†Ø¯. (Ø³Øª Ú©Ø±Ø¯Ù† ÙˆÛŒÚ˜Ú¯ÛŒ `open_in_tab` ØµÙØ­Ù‡ Ø¬Ø¯ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø² Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯.)
* ØµÙØ­Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡ ([`Extension pages`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages){:target="_blank"}{:rel="noopener noreferrer"}): Ù‡Ø± Ø§ÙØ²ÙˆÙ†Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¬Ø¯Ø§ Ø§Ø² ØµÙØ­Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´ ÙØ±Ø¶ØŒ Ø¯Ø±Ø¨Ø±Ø¯Ø§Ø±Ù†Ø¯Ù‡ ØµÙØ­Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ Ø®ÙˆØ¯Ø´ Ù†ÛŒØ² Ø¨Ø§Ø´Ø¯ Ú©Ù‡ Ø§ÛŒÙ†Ø¬Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.
* Ù…Ù†Ø§Ø¨Ø¹ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§ ([`Web accessible resources`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources){:target="_blank"}{:rel="noopener noreferrer"}): Ú†Ù†Ø§Ù†Ú†Ù‡ Ø¨Ø®ÙˆØ§Ù‡ÛŒÙ… Ø§Ø² ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ â€«`HTML`â€¬ØŒ â€«`CSS`â€¬ØŒ â€«`JavaScript`â€¬ Ùˆ ... Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒÙ… Ø¢Ù†Ù‡Ø§ Ø±Ø§ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù…Ø´Ø®Øµ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…. (Ù†Ù…ÙˆÙ†Ù‡: Ú†Ù†Ø§Ù†Ú†Ù‡ Ø§ÙØ²ÙˆÙ†Ù‡ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯ Ú©Ù‡ Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒÛŒ Ø±Ø§ Ø¯Ø± ØµÙØ­Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ¨ Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡Ø¯ØŒ Ø¢Ù†Ù‡Ø§ Ø±Ø§ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù…Ø³ÛŒØ±Ø¯Ù‡ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… ØªØ§ Ø¨Ù‡ Ø¢Ù†Ù‡Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒÙ….)
* Ù…Ø¬ÙˆØ²Ù‡Ø§ ([`permissions`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions){:target="_blank"}{:rel="noopener noreferrer"}): Ù…Ø¬ÙˆØ²Ù‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø§ Ø§ÛŒÙ† Ú©Ù„ÛŒØ¯ Ù…Ø´Ø®Øµ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. Ø¨Ø±Ø§ÛŒ Ù…Ø¬ÙˆØ²Ù‡Ø§ÛŒ Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ú©Ù‡ Ù†Ø¯Ø§Ø´ØªÙ† Ø¢Ù†Ù‡Ø§ Ø¬Ù„ÙˆÛŒ Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ Ù†Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ Ø§Ø² Ú©Ù„ÛŒØ¯ [`optional_permissions`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/optional_permissions){:target="_blank"}{:rel="noopener noreferrer"} Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

### Ø±Ø§Ø¨Ø· Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§

Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ú© Ø¨Ù‡ØªØ± `API`Ù‡Ø§ÛŒ Ù…ÙˆØ²ÛŒÙ„Ø§ Ùˆ Ú†Ú¯ÙˆÙ†Ú¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¢Ù†Ù‡Ø§ [Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§](https://developer.mozilla.org/en-US/Add-ons/WebExtensions){:target="_blank"}{:rel="noopener noreferrer"} Ø±Ø§ Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯.

Ø¯Ø± Ø²ÛŒØ± Ù†Ù…ÙˆÙ†Ù‡ ÛŒÚ© `API` ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø¯Ø± ÙØ§ÛŒÙ„ `manifest.json` Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯.

<div class="code-block">
{% highlight json %}
{
  "manifest_version": 2,
  "name": "Extension containing an experimental API",
  "experiment_apis": {
    "apiname": {
      "schema": "schema.json",
      "parent": {
        "scopes": ["addon_parent"],
        "paths": [["myapi"]],
        "script": "implementation.js"
      },

      "child": {
        "scopes": ["addon_child"],
        "paths": [["myapi"]],
        "script": "child-implementation.js"
      }
    }
  }
}
{% endhighlight %}
</div>

Ø¯Ø± Ù‡Ø± `API` ÛŒÚ© ÛŒØ§ Ú†Ù†Ø¯ ÙØ¶Ø§ÛŒ Ù†Ø§Ù… ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ú©Ù‡ Ø§Ø´ÛŒØ§ Ø¢Ù† Ø±Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø¯Ø± Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ú©Ø±Ø¯. Ø¨Ø±Ø§ÛŒ Ù‡Ø± `API` Ø¨Ø§ÛŒØ¯ ÛŒÚ© `schema` ØªØ¹Ø±ÛŒÙ Ø´ÙˆØ¯ Ú©Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ `API` Ø±Ø§ Ù…Ø´Ø®Øµ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ú©Ù„ÛŒØ¯ `schema` Ø¯Ø± ÙØ§ÛŒÙ„ `manifest.json` Ø¯Ø±ÙˆÙ† Ù…Ø³ÛŒØ± Ø§ØµÙ„ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡ ÛŒÚ© Ù…Ø³ÛŒØ± Ù†Ø³Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„ `schema` Ù…Ø´Ø®Øµ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø³Ø±Ù¾Ø±Ø³Øª (`parent process`) Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´Ù‡Ø§ÛŒ ÙØ±Ø²Ù†Ø¯ (`child processes`) Ø¨Ø§ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ `parent` Ùˆ `child` Ø¯Ø± `script `Ù…Ø³ÛŒØ±Ø¯Ù‡ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.

Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± ØªÙ†Ù‡Ø§ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø² Ú©Ù„ÛŒØ¯ `scops` Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø®Øµ Ú©Ø±Ø¯Ù† Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù‡Ø± ÙØ¶Ø§ÛŒ Ù†Ø§Ù… `addon-child` Ùˆ `addon-parent` Ù‡Ø³ØªÙ†Ø¯.

ÙØ§ÛŒÙ„ `schema` Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡ Ù…Ø§Ù‡ÙˆØ±:

<div class="code-block">
{% highlight json %}
[
  {
    "namespace": "MahourDate",
    "functions": [
      {
        "name": "addWindowListener",
        "type": "function",
        "description": "Adds a listener 3pane windows",
        "async": false,
        "parameters": [
          {
            "name": "hich",
            "type": "string",
            "description": "hich"
          }
        ]
      },
      {
        "name": "changeSettings",
        "type": "function",
        "description": "Handle Prefrences",
        "async": true,
        "parameters": [
          {
            "name": "newSettings",
            "type": "object",
            "properties": {
              "longMonth": { "type": "boolean" },
              "showTime": { "type": "boolean" },
              "weekDay": { "type": "boolean" },
              "englishNumbers": { "type": "boolean" }
            }
          }
        ]
      }
    ]
  }
]
{% endhighlight %}
</div>

Ø¯Ø± Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ ÙØ¶Ø§ÛŒ Ù†Ø§Ù… `MahourDate` Ø¯Ùˆ ØªØ§Ø¨Ø¹ `addWindowListener` Ùˆ `changeSettings` ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø§Ø³Øª. ØªØ§Ø¨Ø¹ Ù†Ø®Ø³Øª Ø¯Ø± Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡ ÛŒÚ© `windowListener` Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ù†Ù…Ø§ÛŒØ´ Ø³ØªÙˆÙ† `ØªØ§Ø±ÛŒØ®` Ø¨Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. ØªØ§Ø¨Ø¹ Ø¯ÙˆÙ… Ø¨Ø§ Ø¹ÙˆØ¶ Ú©Ø±Ø¯Ù† ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø³ØªÙˆÙ† `ØªØ§Ø±ÛŒØ®` Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.

> ØªÙˆØ¬Ù‡: ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø§ÛŒÙ† ØªÙˆØ§Ø¨Ø¹ Ø¯Ø± `background script` Ø¨Ø§ÛŒØ¯ Ø¨Ø§ ÛŒÚ© Ù…ØªØºÛŒØ± Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§Ø´Ø¯. Ø¨Ù†Ø§Ø¨Ø±Ø§ÛŒÙ† Ù‡Ø± Ú†Ù†Ø¯ `addWindowListener` Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø¨Ø±Ø§ÛŒ Ø¢Ù† ÛŒÚ© Ù…ØªØºÛŒØ± Ø¨Ù‡ Ù†Ø§Ù… `hich` (Ù‡ÛŒÚ†ğŸ˜‚) ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø§Ø³Øª.

Ø§ÛŒÙ† ØªÙˆØ§Ø¨Ø¹ Ø¯Ø±ÙˆÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª `api/experiments.js` ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯ØŒ Ú©Ù‡ Ø¯Ø± ÙˆÛŒÚ˜Ú¯ÛŒ `parent` Ø±Ø§Ø¨Ø· Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ÛŒ `MahourDate` Ø¯Ø± ÙØ§ÛŒÙ„ `manifest.json` Ø§ÙØ²ÙˆÙ†Ù‡ Ù…Ø³ÛŒØ±Ø¯Ù‡ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.

ÙØ§ÛŒÙ„ `experiment.js`:

<div class="code-block">
{% highlight javascript %}
// This Source Code Form is subject to the terms of the
// GNU General Public License, version 3.0.

"use strict";

var { Services } = ChromeUtils.import("resource://gre/modules/Services.jsm");
var { ExtensionSupport } = ChromeUtils.import(
  "resource:///modules/ExtensionSupport.jsm"
);
var { ExtensionParent } = ChromeUtils.import(
  "resource://gre/modules/ExtensionParent.jsm"
);

const EXTENSION_NAME = "mahour@zmim.ir";
var extension = ExtensionParent.GlobalManager.getExtension(EXTENSION_NAME);

//customizeable options
var monthStyle = "long";
var timeStyle = "2-digit";
var weekDayStyle = "hidden";
var numbersStyle = "arabext";

// Implements the functions defined in the experiments section of schema.json.
var MahourDate = class extends ExtensionCommon.ExtensionAPI {
  onStartup() {}

  onShutdown(isAppShutdown) {
    if (isAppShutdown) return;
    // Looks like we got uninstalled. Maybe a new version will be installed now.
    // Due to new versions not taking effect (https://bugzilla.mozilla.org/show_bug.cgi?id=1634348)
    // we invalidate the startup cache. That's the same effect as starting with -purgecaches
    // (or deleting the startupCache directory from the profile).
    Services.obs.notifyObservers(null, "startupcache-invalidate");
  }

  getAPI(context) {
    context.callOnClose(this);
    return {
      MahourDate: {
        addWindowListener(hich) {
          // Adds a listener to detect new windows.
          ExtensionSupport.registerWindowListener(EXTENSION_NAME, {
            chromeURLs: [
              "chrome://messenger/content/messenger.xul",
              "chrome://messenger/content/messenger.xhtml",
            ],
            onLoadWindow: paint,
            onUnloadWindow: unpaint,
          });
        },
        changeSettings(newSettings) {
          if (newSettings.longMonth) {
            monthStyle = "long";
          } else {
            monthStyle = "2-digit";
          }
          if (newSettings.showTime) {
            timeStyle = "2-digit";
          } else {
            timeStyle = "hidden";
          }
          if (newSettings.weekDay) {
            weekDayStyle = "long";
          } else {
            weekDayStyle = "hidden";
          }
          if (newSettings.englishNumbers) {
            numbersStyle = "latn";
          } else {
            numbersStyle = "arabext";
          }
          for (let win of Services.wm.getEnumerator("mail:3pane")) {
            win.MahourDate.MahourDateHeaderView.destroy();
            win.MahourDate.MahourDateHeaderView.init(win);
          }
        },
      },
    };
  }

  close() {
    ExtensionSupport.unregisterWindowListener(EXTENSION_NAME);
    for (let win of Services.wm.getEnumerator("mail:3pane")) {
      unpaint(win);
    }
  }
};

function paint(win) {
  win.MahourDate = {};
  Services.scriptloader.loadSubScript(
    extension.getURL("content/customcol.js"),
    win.MahourDate
  );
  win.MahourDate.MahourDateHeaderView.init(win);
}

function unpaint(win) {
  win.MahourDate.MahourDateHeaderView.destroy();
  delete win.MahourDate;
}
{% endhighlight %}
</div>

Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø§Ù…Ú©Ø§Ù† ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ ØªÙˆØ§Ø¨Ø¹ `addWindowListener` Ùˆ `changeSettings` ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ø¢Ù†Ù‡Ø§ Ø±Ø§ Ø¨Ø§ Ø§Ù„Ú¯ÙˆÛŒ Ù…Ø´Ø®Øµ Ø´Ø¯Ù‡ Ø¯Ø± [Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù…ÙˆØ²ÛŒÙ„Ø§](https://firefox-source-docs.mozilla.org/toolkit/components/extensions/webextensions/functions.html){:target="_blank"}{:rel="noopener noreferrer"} Ùˆ Ø¯Ø±ÙˆÙ† `getAPI(context)` ØªØ¹Ø±ÛŒÙ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒÙ….

ØªØ§Ø¨Ø¹  `addWindowListener` Ø¨Ø§ eventÙ‡Ø§ÛŒ `onLoadWindow` Ùˆ `onUnloadWindow` Ø¨Ù‡ ØªØ±ØªÛŒØ¨ ØªÙˆØ§Ø¨Ø¹ `paint` Ùˆ `unpaint` Ø±Ø§ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. ØªØ§Ø¨Ø¹ `paint` Ø¨Ø§ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª `content/customcol.js` Ù…Ø­ØªÙˆØ§ÛŒ Ø³ØªÙˆÙ† Ø±Ø§ ØªÙˆÙ„ÛŒØ¯ Ú©Ø±Ø¯Ù‡ Ùˆ Ø¢Ù† Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯. ØªØ§Ø¨Ø¹ `unpaint` Ù†Ù…Ø§ÛŒØ´ Ø³ØªÙˆÙ† Ø±Ø§ Ù…ØªÙˆÙ‚Ù Ùˆ Ù…Ø­ØªÙˆØ§ÛŒ Ø¢Ù† Ø±Ø§ Ù¾Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 

Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´ ÙØ±Ø¶ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ… Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯. Ø¯Ø± ØµÙˆØ±Øª ØªØºÛŒÛŒØ± Ø¢Ù†Ù‡Ø§ Ø¯Ø± ØµÙØ­Ù‡ Ø³Ø§Ù…Ø§Ù†Ø¯Ù‡ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡ ØªØ§Ø¨Ø¹ `changeSetting` Ø¨Ø§ ÙˆØ§Ø³Ø·Ù‡ `background.js` ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø´Ø¯Ù‡ Ùˆ Ø³ØªÙˆÙ† ØªØ§Ø±ÛŒØ® Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯. 

ÙØ§ÛŒÙ„ `content/customcol.js`:


<div class="code-block">
{% highlight javascript %}
// This Source Code Form is subject to the terms of the
// GNU General Public License, version 3.0.
var { AppConstants } = ChromeUtils.import(
  "resource://gre/modules/AppConstants.jsm"
);
var { Services } = ChromeUtils.import("resource://gre/modules/Services.jsm");

const jalaliDateColumnHandler = {
  init(win) {
    this.win = win;
  },
  getCellText(row, col) {
    var date = new Date(this.getJalaliDate(this.win.gDBView.getMsgHdrAt(row)));
    var currentDate = new Date();

    //fixed options
    var yearStyle = "2-digit";
    var dayStyle = "2-digit";

    var locale = "fa-IR-u-nu-" + numbersStyle + "-ca-persian";

    var year = date.toLocaleString(locale, { year: yearStyle });
    var month = date.toLocaleString(locale, { month: monthStyle });
    var day = date.toLocaleString(locale, { day: dayStyle });
    var weekDay =
      weekDayStyle != "hidden"
        ? date.toLocaleString(locale, { weekday: weekDayStyle })
        : "";
    var time =
      timeStyle != "hidden"
        ? date.toLocaleString(locale, {
            hour: timeStyle,
            minute: timeStyle,
            hour12: false,
          }) + " ØŒ"
        : "";

    //fix for bug that doesn't prepend zero to farsei
    if (time.length != 7 && timeStyle != "hidden") {
      var zero = numbersStyle === "arabext" ? "Û°" : "0";
      time = zero + time;
    }
    var isCurrentYear;
    if (currentDate.toLocaleString(locale, { year: yearStyle }) == year) {
      isCurrentYear = true;
    } else {
      isCurrentYear = false;
    }
    var isCurrentDay;
    if (date.toDateString() === currentDate.toDateString()) {
      isCurrentDay = true;
    } else {
      isCurrentDay = false;
    }
    var isYesterday;
    var yesterdayDate = new Date();
    yesterdayDate.setDate(currentDate.getDate() - 1);
    if (date.toDateString() === yesterdayDate.toDateString()) {
      isYesterday = true;
    } else {
      isYesterday = false;
    }

    var placehodler;
    if (monthStyle === "long") {
      placeholder = "TT \u202BWD DD MM YY\u202C";
    } else {
      placeholder = "TT YY/MM/DD WD";
    }

    //remove year if it's current year
    if (isCurrentYear) {
      placeholder = placeholder.replace(/YY./, "");
    }
    //only show time if it's current day or yesterday
    if (isCurrentDay) {
      placeholder = "TT Ø§Ù…Ø±ÙˆØ²";
    } else if (isYesterday) {
      placeholder = "TT Ø¯ÛŒØ±ÙˆØ²";
    }

    dateString = placeholder
      .replace("YY", year)
      .replace("MM", month)
      .replace("DD", day)
      .replace("WD", weekDay)
      .replace("TT", time);

    return dateString;
  },
  getSortStringForRow(hdr) {
    return this.getJalaliDate(hdr);
  },
  isString() {
    return true;
  },
  getCellProperties(row, col, props) {},
  getRowProperties(row, props) {},
  getImageSrc(row, col) {
    return null;
  },
  getSortLongForRow(hdr) {
    return 0;
  },
  getJalaliDate(aHeader) {
    return aHeader.date / 1000;
  },
};

const columnOverlay = {
  init(win) {
    this.win = win;
    this.addColumns(win);
  },

  destroy() {
    this.destroyColumns();
  },

  observe(aMsgFolder, aTopic, aData) {
    try {
      jalaliDateColumnHandler.init(this.win);
      this.win.gDBView.addColumnHandler(
        "jalaliDateColumn",
        jalaliDateColumnHandler
      );
    } catch (ex) {
      console.error(ex);
      throw new Error("Cannot add column handler");
    }
  },

  addColumn(win, columnId, columnLabel) {
    if (win.document.getElementById(columnId)) return;

    const treeCol = win.document.createXULElement("treecol");
    treeCol.setAttribute("id", columnId);
    treeCol.setAttribute("persist", "hidden ordinal sortDirection width");
    treeCol.setAttribute("flex", "2");
    treeCol.setAttribute("closemenu", "none");
    treeCol.setAttribute("label", columnLabel);
    treeCol.setAttribute("tooltiptext", "ØªØ§Ø±ÛŒØ® Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ");

    const threadCols = win.document.getElementById("threadCols");
    threadCols.appendChild(treeCol);

    // Restore persisted attributes.
    let attributes = Services.xulStore.getAttributeEnumerator(
      this.win.document.URL,
      columnId
    );
    for (let attribute of attributes) {
      let value = Services.xulStore.getValue(
        this.win.document.URL,
        columnId,
        attribute
      );
      // See Thunderbird bug 1607575 and bug 1612055.
      if (
        attribute != "ordinal" ||
        parseInt(AppConstants.MOZ_APP_VERSION, 10) < 74
      ) {
        treeCol.setAttribute(attribute, value);
      } else {
        treeCol.ordinal = value;
      }
    }

    Services.obs.addObserver(this, "MsgCreateDBView", false);
  },

  addColumns(win) {
    this.addColumn(win, "jalaliDateColumn", "ØªØ§Ø±ÛŒØ®");
  },

  destroyColumn(columnId) {
    const treeCol = this.win.document.getElementById(columnId);
    if (!treeCol) return;
    treeCol.remove();
  },

  destroyColumns() {
    this.destroyColumn("jalaliDateColumn");
    Services.obs.removeObserver(this, "MsgCreateDBView");
  },
};

var MahourDateHeaderView = {
  init(win) {
    this.win = win;
    columnOverlay.init(win);

    // Usually the column handler is added when the window loads.
    // In our setup it's added later and we may miss the first notification.
    // So we fire one ourserves.
    if (
      win.gDBView &&
      win.document.documentElement.getAttribute("windowtype") == "mail:3pane"
    ) {
      Services.obs.notifyObservers(null, "MsgCreateDBView");
    }
  },

  destroy() {
    columnOverlay.destroy();
  },
};
{% endhighlight %}
</div>

Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ Ø³ØªÙˆÙ† Ø§ÛŒÙ†Ø¬Ø§ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø³ØªÙˆÙ† Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

### Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡

Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ Ù…Ø´Ø®ØµÙ‡ [`window`](https://developer.mozilla.org/en-US/docs/Web/API/Window){:target="_blank"}{:rel="noopener noreferrer"} Ø±Ø§ Ø¨Ø§ ÙˆÛŒÚ˜Ú¯ÛŒ [`Document Object Model`](https://developer.mozilla.org/en-US/docs/Glossary/DOM){:target="_blank"}{:rel="noopener noreferrer"} Ø¯Ø§Ø±Ù†Ø¯.

ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ ØµÙØ­Ù‡ Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡:

ØµÙØ­Ù‡ Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ Ø§ÙØ²ÙˆÙ†Ù‡ Ù…Ø¬ÙˆØ²Ù‡Ø§ÛŒ Ù„Ø§Ø²Ù… Ø±Ø§ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ù‡ `WebExtension API`Ù‡Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯. Ù‡Ù…Ú†Ù†ÛŒÙ† Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒØ²Ø¨Ø§Ù† ([`host permissions`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions){:target="_blank"}{:rel="noopener noreferrer"}) Ø§Ù…Ú©Ø§Ù† ÙØ±Ø³ØªØ§Ø¯Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ `XHR` Ø±Ø§ Ø¯Ø§Ø±Ø¯. Ø¨Ø±Ø§ÛŒ Ø¢Ú¯Ø§Ù‡ÛŒ Ø¨ÛŒØ´ØªØ± Ø¯Ø± Ø§ÛŒÙ† Ø²Ù…ÛŒÙ†Ù‡ Ú©Ù„ÛŒØ¯ ÙˆØ§Ú˜Ù‡ `Cross-origin access` Ø±Ø§ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯.

Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ ØµÙØ­Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ¨ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø§Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§ ([`content scripts`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts){:target="_blank"}{:rel="noopener noreferrer"}) Ø±Ø§ Ø¯Ø± Ø¢Ù†Ù‡Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†Ø¯ Ùˆ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² [`message-passing API`](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Content_scripts#Communicating_with_background_scripts){:target="_blank"}{:rel="noopener noreferrer"} Ø¨Ø§ Ø¢Ù†Ù‡Ø§ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø±Ù‚Ø±Ø§Ø± Ú©Ù†Ø¯. Ø§Ø² Ø§ÛŒÙ† Ø´ÛŒÙˆÙ‡ Ø¯Ø± Ø§ÙØ²ÙˆÙ†Ù‡ Ù…Ø§Ù‡ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.

> Ù†Ú©ØªÙ‡: Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ø¨Ø¬Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒÛŒ  Ù†ÛŒØ² Ø¯Ø§Ø±Ù†Ø¯. Ù†Ø¯Ø§Ø´ØªÙ† ØªÙˆØ§Ù† ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ `eval()` Ù†Ù…ÙˆÙ†â€ŒØ§ÛŒ Ø§Ø² Ø§ÛŒÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ Ø§Ø³Øª.
> Ø¨Ø±Ø§ÛŒ Ø¢Ú¯Ø§Ù‡ÛŒ Ø¨ÛŒØ´ØªØ± [`Content Security Policy`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy){:target="_blank"}{:rel="noopener noreferrer"} Ø±Ø§ Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯.
> Ù‡Ù…Ú†Ù†ÛŒÙ† Ø§Ù…Ú©Ø§Ù† ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ `alert()`ØŒ `confirm()`ØŒ ÛŒØ§ `prompt()` Ù†ÛŒØ² Ø¯Ø± Ø§ÛŒÙ† ØµÙØ­Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.

Ú©Ø¯ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡ Ù…Ø§Ù‡ÙˆØ±:
<div class="code-block">
{% highlight javascript %}
"use strict";

/*
Default settings. Initialize storage to these values.
*/
var datePrefrences = {
  longMonth: true,
  showTime: true,
  weekDay: false,
  englishNumbers: false,
};

/*
Generic error logger.
*/
function onError(e) {
  console.error(e);
}

/*
On startup, check whether we have stored settings.
If we don't, then store the default settings.
*/
function checkStoredSettings(storedSettings) {
  if (!storedSettings.datePrefrences) {
    browser.storage.local.set({ datePrefrences });
  }
}

function repaint(newSettings) {
  browser.MahourDate.changeSettings(newSettings);
}

const gettingStoredSettings = browser.storage.local.get();
gettingStoredSettings.then(checkStoredSettings, onError);

/* globals browser */
var init = async () => {
  browser.MahourDate.addWindowListener("hich");
};

init();
{% endhighlight %}
</div>

Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² â€ª`browser.storage.local.get()`â€¬ Ùˆ â€ª`browser.storage.local.set()`â€¬ Ø¯Ø± ÙØ§ÛŒÙ„ `manifest.jason` Ù…Ø¬ÙˆØ² `storage` Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª. `MahourDate` Ø´Ù†Ø§Ø³Ù‡ `API` ØªØ§Ø²Ù‡ Ø§ÛŒÙ† Ø§ÙØ²ÙˆÙ†Ù‡ Ø§Ø³Øª. Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `browser.MahourDate.changeSettings(newSettings)` ÛŒÚ©ÛŒ Ø§Ø² ØªÙˆØ§Ø¨Ø¹ Ø¢Ù† Ø¨Ø±Ø§ÛŒ Ø§Ø¹Ù…Ø§Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

# Ù…Ù†Ø§Ø¨Ø¹ Ù…ÙÛŒØ¯:

Ø§Ú¯Ø± Ø¨Ø§ Ø³Ø§Ø®Øª Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ Ø¢Ø´Ù†Ø§ÛŒÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯ Ùˆ ØªØ§Ø²Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯ Ø§ÛŒÙ† ÙˆÛŒØ¯ÛŒÙˆÛŒ Ø¢Ù‚Ø§ÛŒ Ø´Ø¬Ø§Ø¹ÛŒ Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯:
<div class="video">
  <iframe sandbox="allow-same-origin allow-scripts allow-popups" src="https://peertube.linuxrocks.online/videos/embed/d70182ca-9ea9-4411-bd24-86dcbff95ceb" frameborder="0" allowfullscreen></iframe>
</div>
Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ Ø±ÙˆÛŒ Thunderbird Ø¯Ø± ØµÙØ­Ù‡ `Add-ons Manager`  Ø±ÙˆÛŒ `Tools for all add-ons` (<i class="fa fa-cog"></i> <i class="fa  fa-chevron-down"></i>) Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯. Ø¨Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú¯Ø²ÛŒÙ†Ù‡ `Debug Add-ons` ÛŒÚ© ØªØ¨ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§Ø² Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ Ø¯Ø± Ø¢Ù† Ø§ÙØ²ÙˆÙ†Ù‡ Ù‡Ø§ Ø±Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…ÙˆÙ‚ØªØ§ Ù†ØµØ¨ Ùˆ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯. Ú©Ø§ÙÛŒ Ø§Ø³Øª Ø±ÙˆÛŒ `Load Temporary Add-on` Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ Ùˆ ÙØ§ÛŒÙ„ `manifest.json` Ø§ÙØ²ÙˆÙ†Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.

- [Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡ Ø±Ø§Ø¨Ø· Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§](https://firefox-source-docs.mozilla.org/toolkit/components/extensions/webextensions/index.html){:target="_blank"}{:rel="noopener noreferrer"}
- [Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions){:target="_blank"}{:rel="noopener noreferrer"}
- [Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡](https://github.com/mdn/webextensions-examples){:target="_blank"}{:rel="noopener noreferrer"}

